function make_editable(e){$(e).editable(function(e,i){var a=$("#token").html(),r=$(this).parent().attr("rel");return $.getJSON("index.php",{route:"catalog/serial/updateOrderSerial",serial_id:r,serial:e.toString(),token:a},function(e){e.error&&alert("The serial was not updated")}),e},{submit:"Update"})}$(function(){var r=$("#order_id").html(),t=$("#token").html();make_editable(".editable"),$(".serialRemove").live("click",function(){var e=$(this).parent(),i=$(this);if(i.hasClass("noClick"))return!1;i.addClass("noClick");var a=e.attr("rel");return e.append('&nbsp;<img src="view/image/loading.gif" id="ajax_spinner_'+a+'" />'),$.getJSON("index.php",{route:"catalog/serial/removeOrderSerial",token:t,order_id:r,serial_id:a},function(e){$("#ajax_spinner_"+e.serial_id).remove(),e.error?alert("ERROR REMOVING SERIAL KEY"):$("div[rel*="+e.serial_id+"]").fadeOut("slow",function(){$(this).remove()})}),!1}),$(".serialAdd").click(function(){var e=$(this).attr("rel"),i=$("#add_serial_"+e).val();return 0==(i=i.replace(/^\s+|\s+$/,"")).length?alert("Please enter a valid serial key"):($("#add_serial_"+e).parent().append(' <img src="view/image/loading.gif" id="loading_'+e+'" />'),$.getJSON("index.php",{route:"catalog/serial/addOrderSerial",token:t,order_id:r,serial:i,product_id:e},function(e){$("#loading_"+e.product_id).remove(),e.error?alert("ERROR INSERTING KEY"):($("#add_serial_"+e.product_id).val(""),$("#no_serials_"+e.product_id).remove(),$("#serials_list_"+e.product_id).append('<div style="padding: 1px;" rel="'+e.serial_key_id+'"><span class="editable" style="font-family: monospace;">'+e.serial+'</span> <img src="view/image/delete.png" class="serialRemove" alt="" /></div>'),make_editable("div[rel*="+e.serial_key_id+"] > .editable"))})),!1})});